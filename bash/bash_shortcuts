# Bash shortcuts
function sbash() {
    if [ "$(uname)" == "Darwin" ]; then
        source ~/.bash_profile;
        echo 'bash_profile reloaded!'
    elif [ "$(uname)" == "Linux" ]; then
        source ~/.bashrc;
        echo 'bashrc reloaded!'
    fi
}

function remap_caps() {
    setxkbmap -option 'caps:ctrl_modifier'
    xcape -t 120 -e 'Caps_Lock=Escape;Control_L=Escape;Control_R=Escape'
}
if [ $HOSTNAME = "jarwin" ]; then
    remap_caps
fi

function setup_devilspie() {
    sudo apt-get install devilspie
    mkdir ~/.devilspie
    echo -e '(if\n\t(matches (window_name) "Terminal")\n\t(opacity 90)\n)' >> ~/.devilspie/terminal-opacity.ds
}

function setup_cmls() {
    cd;
    mkdir cmls;
    git clone git@bitbucket.org:seamless_team/seamless.git;
    git clone git@bitbucket.org:seamless_team/fvalue.git;
    git clone git@bitbucket.org:seamless_team/hrvalue.git;
    git clone git@bitbucket.org:seamless_team/tvalue.git;
    git clone git@bitbucket.org:seamless_team/notes.git;
    git clone https://github.com/anthony-khong/anthony-khong.github.io;
    git clone https://github.com/anthony-khong/mls;
}


HISTCONTROL=ignoreboth
HISTIGNORE='ls:bg:fg:history:hh'
alias hh=history
alias clear_history='cat /dev/null > ~/.bash_history && history -c'

# Tmux shortcut
function tnew {
    tmux new-session -As `basename $PWD`
}

# Pandoc shortcuts
function md_to_pdf() {
    pandoc -V geometry:margin="$1"cm -o $3 $2
}
function md_to_wiki() {
    pandoc -r markdown $1 -t mediawiki -o $2
}

# Python shortcuts
alias pi='THEANO_FLAGS="device=cpu" ipython -i'
alias py='THEANO_FLAGS="device=cpu" ipython -i'
alias gpy='THEANO_FLAGS="device=gpu0" ipython -i'
alias gpy0='THEANO_FLAGS="device=gpu0" ipython -i'
alias gpy1='THEANO_FLAGS="device=gpu1" ipython -i'
alias gpy2='THEANO_FLAGS="device=gpu2" ipython -i'
alias gpy3='THEANO_FLAGS="device=gpu3" ipython -i'
alias pylab='ipython --pylab'
alias pt='py.test -s --pdb'
alias python='/anaconda/bin/python'

alias py_=~/third_party/pypy-4.0.1-osx64/bin/ipython
alias pip_=~/third_party/pypy-4.0.1-osx64/bin/pypy

function mkinit() {
    echo '' >> __init__.py
}

function remove_pyc() {
    find . -name "*.pyc" -exec rm -rf {} \;
}

# Git shortcuts
function fastpush() {
    git add -u;
    git commit -m "$*";
    git push;
}

function gsu() {
    git submodule init;
    git submodule update;
}

function diffs() {
    vim `git ls-files -m` -p;
}

function echo_and_pull() {
    printf 'Pulling the repository %s...\n' "${PWD##*/}";
    git pull;
}

alias gst='git status'
alias gpl='git pull'
alias gps='git push'
alias gco='git commit'
alias gb='git branch'
alias gch='git checkout'

# Dotfiles shortucts
function update_dots() {
    cd ~/dotfiles && echo_and_pull;
    gsu;
    nvim +PlugInstall +qall
}

function update_cmls() {
    cd ~/cmls/seamless && echo_and_pull;
    cd ~/cmls/hrvalue && echo_and_pull;
    cd ~/cmls/fvalue && echo_and_pull;
    cd ~/cmls/tvalue && echo_and_pull;
    cd ~/cmls/notes && echo_and_pull;
    cd ~/cmls;
}

function update_third_party() {
    cd ~/third_party/xgboost && echo_and_pull;
    cd ~/third_party/tensorflow && echo_and_pull;
    cd ~/third_party;
}

function gpa() {
    cwd=$(pwd)
    update_dots;
    update_cmls;
    cd $cwd;
}

function recreate_symbolic_links() {
    cd;
    if [ "$(uname)" == "Darwin" ]; then
        rm .bash_profile;
        ln -s dotfiles/bash/bash_profile .bash_profile;
    elif [ "$(uname)" == "Linux" ]; then
        rm .bashrc;
        ln -s dotfiles/bash/bashrc .bashrc;
    fi

    rm .inputrc;
    ln -s dotfiles/bash/inputrc .inputrc;

    cd;
    rm .vimrc;
    rm -rf .vim;
    ln -s ~/dotfiles/vim/vimrc .vimrc;
    ln -s ~/dotfiles/vim/ .vim;

    mkdir -p ${XDG_CONFIG_HOME:=$HOME/.config};
    rm $XDG_CONFIG_HOME/nvim;
    ln -s ~/dotfiles/vim $XDG_CONFIG_HOME/nvim;

    rm .tmux.conf;
    ln -s ~/dotfiles/tmux/tmux.conf .tmux.conf;
}

function setup_nvim() {
    nvim +PlugInstall +qall;
    nvim +PlugUpdate +qall;
    nvim +PlugInstall +qall;
}

function clone_dotfiles() {
    git clone git@github.com:anthony-khong/dotfiles.git;
    cd dotfiles;
    gsu;

    recreate_symbolic_links;

    setup_nvim;
    sbash;
}

function fix_nvim_tmux_navigator () {
    infocmp $TERM | sed 's/kbs=^[hH]/kbs=\\177/' > $TERM.ti
    tic $TERM.ti
}

# Navigation shortcuts
function dropbox_hr_value() {
    cd ~/Dropbox/am_records/hr_value
}

function gpy() {
    cd ~/Dropbox/tutorials/gpy
}

function papers() {
    cd ~/Dropbox/Interesting\ Papers/
}

function bayes_ml() {
    cd ~/Dropbox/Interesting\ Papers/Bayesian\ Machine\ Learning/
}

function deep() {
    cd ~/Dropbox/Interesting\ Papers/Deep\ Learning/
}

function ensembles() {
    cd ~/Dropbox/Interesting\ Papers/Ensemble\ Methods/
}

function mcm() {
    cd ~/Dropbox/Interesting\ Papers/Monte\ Carlo\ Methods/
}


function seamless() {
    cd ~/cmls/seamless/
}
alias sless=seamless
alias seams=seamless

function fv() {
    cd ~/cmls/fvalue/
}

function hrv() {
    cd ~/cmls/hrvalue/
}

function tv() {
    cd ~/cmls/tvalue/
}

function dots() {
    cd ~/dotfiles/
}

function lasagne() {
    cd ~/third_party/Lasagne/lasagne
}
alias nnet='cd ~/cmls/seamless/models/nnet'

# Networking shortcuts
function jarwin() {
    ssh -4 -X akkhong@jarwinjkt.no-ip.biz
}

function cuffy() {
    ssh -4 -X akk@ilikezcoffe.no-ip.biz
}

function servox() {
    ssh -p2222 -X akkhong@servox.no-ip.biz
}

function servox_as_mbk() {
    ssh -p2222 -X mbk@servox.no-ip.biz
}

function linode1() {
    ssh root@85.159.211.149
}


function local_jarwin() {
    ssh -X akkhong@192.168.1.107
}

function bealach() {
    ssh -X akkhong@192.168.1.110
}

function samhan() {
    ssh -X akkhong@192.168.1.109
}

function stream_webcam() {
    vlc v4l2:///dev/video0
}

function flush_dns_cache() {
    sudo dscacheutil -flushcache
    sudo killall -HUP mDNSResponder
    say cache flushed
}

function check_my_ip() {
    curl -s checkip.dyndns.org | sed -e 's/.*Current IP Address: //' -e 's/<.*$//'
}

# Vim shortcuts
alias vi="/usr/bin/vim -p"
alias vim="nvim -p"
alias vff="nvim +'FZF ~'"
function eff() {
    vim $(fzf)
}

# Jekyll
alias jserve="bundle exec jekyll serve --drafts --watch"

# Karabiner
alias karabiner="/Applications/Karabiner.app/Contents/Library/bin/karabiner"

function fix_cuda_compile() {
    sudo ldconfig /usr/local/cuda/lib64
}

function slack() {
    google-chrome https://cmls.slack.com/messages/general_/
}
